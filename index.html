<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    
    <!-- === SEO æœå°‹å„ªåŒ– === -->
    <title>å¥§å…’çµ²æœµ Our Story | éˆçŸ³ã€å¤©éµéš•çŸ³èˆ‡æ°´æ™¶èƒ½é‡æ”¶è—</title>
    <meta name="description" id="meta-desc" content="å¥§å…’çµ²æœµï¼ˆOur Storyï¼‰å°ˆç‡Ÿé«˜å“è³ªå¤©éµéš•çŸ³ã€æ·å…‹éš•çŸ³ã€èƒ½é‡æ°´æ™¶èˆ‡ç²¾é›•é¾é¾œæ”¶è—ã€‚æä¾›ç·šä¸ŠéˆçŸ³å‘½å®šæ¸¬é©—ï¼Œç‚ºæ‚¨é€£çµå…§å¿ƒæ·±è™•çš„å¹³éœèˆ‡åŠ›é‡ã€‚">
    <meta name="keywords" content="å¥§å…’çµ²æœµ,Our Story,éˆçŸ³,å¤©éµ,éš•çŸ³,é³éµéš•çŸ³,æ·å…‹éš•çŸ³,èƒ½é‡æ°´æ™¶,é¾é¾œ,ç¥ç¸æ“ºä»¶,æ·¨åŒ–ç£å ´,èº«å¿ƒéˆ,ç¤¦çŸ³æ”¶è—,æ°´æ™¶æ‰‹éŠ,èƒ½é‡ç™‚ç™’,éˆçŸ³æ¸¬é©—">
    <meta name="author" content="å¥§å…’çµ²æœµ Our Story">
    <meta name="robots" content="index, follow">
    
    <!-- æ¨™æº–é€£çµ -->
    <link rel="canonical" href="https://our-story.com.tw/">

    <!-- Open Graph ç¤¾ç¾¤åˆ†äº«å„ªåŒ– -->
    <meta property="og:title" id="og-title" content="å¥§å…’çµ²æœµ | é€£çµéˆé­‚çš„èƒ½é‡æ”¶è—">
    <meta property="og:description" id="og-desc" content="æ¢ç´¢å¥§å…’çµ²æœµçš„ç²¾é¸å¤©éµèˆ‡æ°´æ™¶æ”¶è—ã€‚ç«‹å³é«”é©—éˆçŸ³å‘½å®šæ¸¬é©—ï¼Œå°‹æ‰¾æ‚¨çš„å®ˆè­·çŸ³ã€‚">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://our-story.com.tw/">
    <meta property="og:image" content="https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&q=80&w=1200">
    <meta property="og:site_name" content="å¥§å…’çµ²æœµ Our Story">
    
    <!-- çµæ§‹åŒ–è³‡æ–™ (Schema.org) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Store",
      "name": "å¥§å…’çµ²æœµ Our Story",
      "description": "å°ˆæ¥­ç²¾é¸å¤©ç„¶éˆçŸ³ã€å¤©éµéš•çŸ³èˆ‡ç¾å­¸å“ç‰Œ",
      "image": "https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?auto=format&fit=crop&q=80&w=200",
      "url": "https://our-story.com.tw/",
      "priceRange": "$$"
    }
    </script>

    <!-- Tailwind CSS & Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Instagram å®˜æ–¹è…³æœ¬ -->
    <script async src="//www.instagram.com/embed.js"></script>
    <!-- è¾²æ›†è½‰æ›åº« -->
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Sans:wght@300;400;500;700&display=swap');
        body { 
            font-family: 'Noto Sans', 'Noto Sans TC', sans-serif; 
            background-color: #FAF9F6; 
            color: #44403c; 
            scroll-behavior: smooth; 
            -webkit-overflow-scrolling: touch;
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slowZoom { from { transform: scale(1); } to { transform: scale(1.05); } }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translate(-50%, -50%); } to { opacity: 1; transform: scale(1) translate(-50%, -50%); } }

        .animate-fadeIn { animation: fadeIn 1s ease-out forwards; }
        .animate-fadeInUp { animation: fadeInUp 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-slowZoom { animation: slowZoom 30s linear infinite alternate; }
        .modal-enter { animation: modalIn 0.3s ease-out forwards; }
        
        .nav-scrolled { 
            background-color: rgba(255, 255, 255, 0.98); 
            backdrop-filter: blur(12px); 
            padding: 1rem 0; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
            transition: all 0.3s ease;
        }
        
        #mobile-menu { display: none; opacity: 0; transition: opacity 0.4s ease; }
        #mobile-menu.active { display: flex; opacity: 1; }
        
        /* ç®¡ç†é¢æ¿æ¨£å¼ */
        .admin-panel { display: none; position: fixed; top: 0; right: 0; width: 100%; max-width: 450px; height: 100%; background: white; z-index: 1000; box-shadow: -10px 0 30px rgba(0,0,0,0.1); overflow-y: auto; padding: 2.5rem; }
        .admin-panel.active { display: block; }
        
        input, textarea, select { width: 100%; border: 1px solid #d6d3d1; padding: 0.85rem; margin-bottom: 0.5rem; border-radius: 6px; font-size: 0.875rem; background: #fafaf9; color: #1c1917; }
        
        .upload-btn { display: inline-block; background: #f3f4f6; padding: 0.6rem 1rem; border-radius: 6px; font-size: 0.75rem; color: #374151; cursor: pointer; border: 1px solid #d1d5db; margin-bottom: 0.5rem; text-align: center; width: 100%; }
        
        .ai-spirit-box { max-width: 700px; margin: 0 auto; padding: 4rem 2rem; border: 1px dashed #a8a29e; border-radius: 1.5rem; background: rgba(255, 255, 255, 0.7); }
        .loading-overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.98); z-index: 2000; display: none; align-items: center; justify-content: center; font-size: 0.8rem; letter-spacing: 0.3em; }
        
        /* iPhone ç›¸å®¹æ€§æ¨£å¼ */
        .ig-embed-container { width: 100%; min-height: 400px; display: block; overflow: visible !important; background: #fff; position: relative; z-index: 10; pointer-events: auto !important; margin-bottom: 1.5rem; transform: none !important; }
        .ig-embed-container blockquote { margin: 0 auto !important; width: 100% !important; border: 0 !important; padding: 0 !important; min-width: 100% !important; }
        .ig-embed-container iframe { width: 100% !important; max-width: 100% !important; }

        /* æ¸¬é©—å€å¡Šæ¨£å¼ */
        .stone-card { transition: all 0.5s ease; }
        .stone-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .calc-select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; }
    </style>
</head>
<body class="font-normal text-stone-700">

    <div id="loading" class="loading-overlay" aria-hidden="true">
        <div class="flex flex-col items-center">
            <i data-lucide="loader" class="w-8 h-8 animate-spin mb-4 text-stone-400"></i>
            <span>è®€å–éˆçŸ³èƒ½é‡ä¸­...</span>
        </div>
    </div>

    <!-- å°èˆªæ¬„ -->
    <nav id="navbar" class="fixed w-full z-[100] transition-all duration-500 bg-transparent py-6">
        <div class="max-w-7xl mx-auto px-6 md:px-8 flex justify-between items-center">
            <div class="flex items-center cursor-pointer" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                <span id="nav-brand-display" class="text-lg md:text-xl font-bold tracking-[0.3em] text-stone-900 uppercase">å¥§å…’çµ²æœµ</span>
            </div>
            <div class="hidden md:flex space-x-12 items-center">
                <button onclick="window.scrollToSection('about')" class="text-stone-500 hover:text-stone-900 transition-colors text-xs font-medium tracking-[0.3em] uppercase">å“ç‰Œæ•…äº‹</button>
                <!-- ç§»é™¤é‡è¤‡çš„éˆçŸ³æ¸¬é©—é€£çµ -->
                <button onclick="window.scrollToSection('collections')" class="text-stone-500 hover:text-stone-900 transition-colors text-xs font-medium tracking-[0.3em] uppercase">æ”¶è—ç³»åˆ—</button>
                <button onclick="window.scrollToSection('social')" class="text-stone-500 hover:text-stone-900 transition-colors text-xs font-medium tracking-[0.3em] uppercase">è¿½è¹¤æˆ‘å€‘</button>
                <div class="flex items-center border-l border-stone-300 pl-8">
                    <!-- ä¿ç•™å³å´å¸¶åœ–ç¤ºçš„éˆçŸ³æ¸¬é©—æŒ‰éˆ• -->
                    <button onclick="window.scrollToSection('calculator')" class="group flex items-center space-x-2 text-stone-800 hover:text-stone-500 transition-colors">
                        <i data-lucide="sparkles" class="w-4 h-4"></i>
                        <span class="text-xs font-bold tracking-[0.2em] uppercase">éˆçŸ³æ¸¬é©—</span>
                    </button>
                </div>
            </div>
            <button class="md:hidden text-stone-800 p-2" onclick="window.toggleMenu()" aria-label="é¸å–®"><i data-lucide="menu" class="w-6 h-6"></i></button>
        </div>
    </nav>

    <!-- è¡Œå‹•ç«¯é¸å–® -->
    <div id="mobile-menu" class="fixed inset-0 z-[150] bg-white flex flex-col items-center justify-center space-y-10">
        <button class="absolute top-8 right-8 text-stone-600" onclick="window.toggleMenu()" aria-label="é—œé–‰"><i data-lucide="x" class="w-8 h-8"></i></button>
        <button onclick="window.scrollToSection('about')" class="text-xl font-bold tracking-[0.4em] text-stone-800 uppercase">å“ç‰Œæ•…äº‹</button>
        <button onclick="window.scrollToSection('calculator')" class="text-xl font-bold tracking-[0.4em] text-stone-800 uppercase border-b border-stone-800 pb-1">éˆçŸ³æ¸¬é©—</button>
        <button onclick="window.scrollToSection('collections')" class="text-xl font-bold tracking-[0.4em] text-stone-800 uppercase">æ”¶è—ç³»åˆ—</button>
        <button onclick="window.scrollToSection('social')" class="text-xl font-bold tracking-[0.4em] text-stone-800 uppercase">è¿½è¹¤æˆ‘å€‘</button>
    </div>

    <main>
        <!-- ä¸»è¦–è¦º -->
        <header id="home" class="relative h-screen flex items-center justify-center overflow-hidden bg-white">
            <div class="absolute inset-0 z-0">
                <img id="hero-img-display" src="" class="w-full h-full object-cover opacity-30 scale-105 animate-slowZoom" alt="å¥§å…’çµ²æœµå“ç‰ŒèƒŒæ™¯">
            </div>
            <div class="relative z-10 text-center px-6">
                <p id="hero-sub-display" class="text-[10px] md:text-xs tracking-[0.5em] text-stone-600 mb-8 animate-fadeInUp uppercase font-bold">Every stone has its own story</p>
                <h1 id="hero-title-display" class="text-4xl md:text-6xl font-light text-stone-900 mb-10 tracking-[0.3em] leading-[1.6] animate-fadeInUp delay-100 drop-shadow-sm">å¥§å…’çµ²æœµ<br /><span class="text-2xl md:text-3xl tracking-[0.4em] text-stone-600 italic font-normal block mt-4">éˆçŸ³èˆ‡æ‚¨çš„æ•…äº‹</span></h1>
                <button onclick="window.scrollToSection('calculator')" class="mt-8 px-8 py-3 border border-stone-800 text-stone-800 hover:bg-stone-800 hover:text-white transition-all text-xs tracking-[0.3em] uppercase font-bold animate-fadeInUp" style="animation-delay: 0.5s;">å°‹æ‰¾æ‚¨çš„å‘½å®šéˆçŸ³</button>
            </div>
        </header>

        <!-- å“ç‰Œæ•…äº‹ -->
        <section id="about" class="py-24 md:py-40 px-8 bg-white text-center">
            <div class="max-w-3xl mx-auto">
                <div class="mb-12">
                    <a id="about-link-display" href="#" target="_blank" rel="noopener noreferrer" class="block hover:opacity-80 transition-opacity">
                        <img id="about-icon-display" src="" class="w-40 md:w-64 mx-auto object-contain rounded-lg shadow-sm" alt="å®¢æœ QR Code">
                    </a>
                </div>
                <h2 id="about-title-display" class="text-lg md:text-xl font-medium tracking-[0.4em] text-stone-900 mb-12 uppercase">é—œæ–¼ å¥§å…’çµ²æœµ</h2>
                <p id="about-text-display" class="text-stone-600 leading-[2.5] tracking-[0.15em] text-base font-normal whitespace-pre-line text-justify md:text-center"></p>
                <div class="mt-20 ai-spirit-box">
                    <p id="ai-quote" class="text-sm md:text-base text-stone-500 italic tracking-[0.2em] mb-10 leading-relaxed font-medium">ã€Œæ¯ä¸€å¡ŠçŸ³é ­éƒ½æœ‰å®ƒçš„é »ç‡ï¼Œç­‰å¾…èˆ‡æ‚¨å…±é³´ã€‚ã€</p>
                    <button id="btn-daily-quote" onclick="window.generateDailyQuote()" class="text-xs tracking-[0.3em] uppercase px-8 py-3 border border-stone-300 hover:border-stone-900 hover:bg-stone-50 transition-all shadow-sm font-bold text-stone-700">ç²å–ä»Šæ—¥çŸ³èª âœ¨</button>
                </div>
            </div>
        </section>

        <!-- === ğŸ”® å‘½å®šéˆçŸ³æ¸¬é©—å€å¡Š === -->
        <section id="calculator" class="py-24 px-4 bg-stone-50 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-6 z-10">
                <button onclick="window.toggleLanguage()" class="flex items-center space-x-2 text-[10px] font-bold tracking-widest text-stone-500 hover:text-stone-800 transition uppercase border border-stone-200 px-3 py-1.5 rounded-full bg-white shadow-sm">
                    <i data-lucide="globe" class="w-3 h-3"></i>
                    <span id="langLabel">English</span>
                </button>
            </div>
            <div class="max-w-lg mx-auto bg-white p-8 md:p-12 rounded-2xl shadow-xl border border-stone-100 relative z-0">
                <div class="text-center">
                    <div class="mx-auto h-16 w-16 bg-stone-50 rounded-full flex items-center justify-center mb-4"><i data-lucide="sun" class="h-8 w-8 text-stone-400"></i></div>
                    <h2 id="ui-title" class="text-2xl font-medium text-stone-800 tracking-widest mb-2">å°‹æ‰¾æ‚¨çš„å‘½å®šéˆçŸ³</h2>
                    <p id="ui-desc" class="text-xs text-stone-500 tracking-wider leading-relaxed">è¼¸å…¥æ‚¨çš„<span class="font-bold text-stone-700">åœ‹æ›† (Solar)</span> å‡ºç”Ÿæ—¥æœŸï¼Œ<br>ç³»çµ±å°‡è‡ªå‹•æ›ç®—ç²¾ç¢ºçš„è¾²æ›†äº”è¡Œï¼Œ<br>ç‚ºæ‚¨é€£çµé‚£é¡†ç­‰å¾…å·²ä¹…çš„å®ˆè­·çŸ³ã€‚</p>
                </div>
                <form id="calcForm" class="mt-8 space-y-6" onsubmit="window.calculateStone(event)">
                    <div class="space-y-5">
                        <div class="relative">
                            <label id="label-year" for="year" class="block text-xs font-medium text-stone-500 tracking-widest mb-1">åœ‹æ›†å‡ºç”Ÿå¹´</label>
                            <select id="year" required class="calc-select block w-full pl-3 pr-10 py-3 text-sm border border-stone-200 focus:outline-none focus:ring-1 focus:ring-stone-400 focus:border-stone-400 rounded-md bg-stone-50 text-stone-700"><option value="" disabled selected data-i18n="select-year">è«‹é¸æ“‡å¹´ä»½</option></select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="relative">
                                <label id="label-month" for="month" class="block text-xs font-medium text-stone-500 tracking-widest mb-1">åœ‹æ›†æœˆä»½</label>
                                <select id="month" required class="calc-select block w-full pl-3 pr-10 py-3 text-sm border border-stone-200 focus:outline-none focus:ring-1 focus:ring-stone-400 focus:border-stone-400 rounded-md bg-stone-50 text-stone-700"><option value="" disabled selected data-i18n="select-month">æœˆä»½</option></select>
                            </div>
                            <div class="relative">
                                <label id="label-day" for="day" class="block text-xs font-medium text-stone-500 tracking-widest mb-1">åœ‹æ›†æ—¥æœŸ</label>
                                <select id="day" required class="calc-select block w-full pl-3 pr-10 py-3 text-sm border border-stone-200 focus:outline-none focus:ring-1 focus:ring-stone-400 focus:border-stone-400 rounded-md bg-stone-50 text-stone-700"><option value="" disabled selected data-i18n="select-day">æ—¥æœŸ</option></select>
                            </div>
                        </div>
                    </div>
                    <div class="pt-4">
                        <button type="submit" class="group relative w-full flex justify-center py-4 px-4 border border-transparent text-sm font-bold rounded-md text-white bg-stone-800 hover:bg-stone-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-stone-500 transition-all tracking-[0.2em] uppercase shadow-lg">
                            <span id="btn-calc">é–‹å§‹è½‰æ›ä¸¦æ„Ÿæ‡‰</span>
                            <span class="absolute right-0 inset-y-0 flex items-center pr-3"><i data-lucide="arrow-right" class="h-4 w-4 text-stone-400 group-hover:text-white transition"></i></span>
                        </button>
                    </div>
                </form>
                <div id="resultArea" class="hidden text-center space-y-6 pt-6 border-t border-stone-100">
                    <div id="loading-text" class="animate-pulse text-stone-400 text-xs tracking-widest mb-4">æ­£åœ¨æ›ç®—è¾²æ›†äº”è¡Œ...</div>
                </div>
            </div>
        </section>

        <!-- éˆçŸ³å±•ç¤º -->
        <section id="collections" class="py-20 md:py-24 px-6 md:px-20 bg-[#FAF9F6]">
            <div id="collections-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-12 md:gap-16 max-w-7xl mx-auto"></div>
        </section>

        <!-- ç¤¾ç¾¤å€å¡Š -->
        <section id="social" class="py-24 md:py-40 px-8 bg-white">
            <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center gap-16">
                <div class="w-full md:w-2/5 space-y-12">
                    <h2 id="social-title-display" class="text-2xl md:text-3xl font-light tracking-[0.3em] text-stone-900 uppercase">Follow Us</h2>
                    <div class="space-y-4">
                        <a id="ig-link-display" href="#" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between group py-5 border-b border-stone-200"><span id="ig-text-display" class="text-sm tracking-[0.2em] text-stone-600 font-medium uppercase">Instagram</span><i data-lucide="arrow-right" class="w-4 h-4 text-stone-400 group-hover:translate-x-1 transition-transform group-hover:text-stone-800"></i></a>
                        <a id="fb-link-display" href="#" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between group py-5 border-b border-stone-200"><span id="fb-text-display" class="text-sm tracking-[0.2em] text-stone-600 font-medium uppercase">Facebook</span><i data-lucide="arrow-right" class="w-4 h-4 text-stone-400 group-hover:translate-x-1 transition-transform group-hover:text-stone-800"></i></a>
                    </div>
                </div>
                <div id="gallery-container" class="w-full md:w-3/5 grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                    <div class="space-y-6">
                        <div id="ig-slot-1" class="ig-embed-container shadow-md"></div>
                        <div id="ig-slot-2" class="ig-embed-container shadow-md"></div>
                    </div>
                    <div class="space-y-6 md:pt-12">
                        <div id="ig-slot-3" class="ig-embed-container shadow-md"></div>
                        <div id="ig-slot-4" class="ig-embed-container shadow-md"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- è¯çµ¡å°ˆå“¡ Modal -->
    <div id="contactModal" class="fixed inset-0 z-[200] hidden">
        <div class="absolute inset-0 bg-stone-900/60 backdrop-blur-sm transition-opacity" onclick="window.closeContactModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white w-full max-w-sm rounded-2xl p-8 shadow-2xl modal-enter">
            <div class="text-center mb-6">
                <h3 id="modal-title" class="text-xl font-bold text-stone-800 tracking-widest mb-2">å°ˆå“¡è³¼è—å”åŠ©</h3>
                <p id="modal-desc" class="text-xs text-stone-500 leading-relaxed">è«‹ç•™ä¸‹æ‚¨çš„è³‡è¨Šï¼Œå°ˆå“¡å°‡ç‚ºæ‚¨ä»‹ç´¹ç¾è²¨æ¬¾å¼èˆ‡è³¼è²·æµç¨‹ã€‚<br><span class="text-stone-400 font-light block mt-1">(æ­¤æœå‹™å°ˆæ³¨æ–¼å”åŠ©è³¼è²·æŒ‘é¸ï¼Œéå‘½ç†è«®è©¢)</span></p>
            </div>
            <form id="contactForm" onsubmit="window.handleContactSubmit(event)" class="space-y-4">
                <div>
                    <label id="label-cName" for="cName" class="block text-xs font-medium text-stone-500 mb-1">æ‚¨çš„ç¨±å‘¼</label>
                    <input type="text" id="cName" required class="w-full px-3 py-2 border border-stone-200 rounded-md text-sm focus:outline-none focus:border-stone-400 bg-stone-50" placeholder="Name">
                </div>
                <div>
                    <label id="label-cContact" for="cContact" class="block text-xs font-medium text-stone-500 mb-1">è¯çµ¡æ–¹å¼ (æ‰‹æ©Ÿ / LINE ID)</label>
                    <input type="text" id="cContact" required class="w-full px-3 py-2 border border-stone-200 rounded-md text-sm focus:outline-none focus:border-stone-400 bg-stone-50" placeholder="Contact Info">
                </div>
                <button id="btn-submit" type="submit" class="w-full py-3 bg-stone-800 text-white text-xs font-bold tracking-[0.2em] uppercase rounded hover:bg-stone-700 transition mt-2">ç¢ºèªé€å‡º</button>
            </form>
            <button onclick="window.closeContactModal()" class="absolute top-4 right-4 text-stone-400 hover:text-stone-600"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
    </div>

    <!-- ç®¡ç†ç·¨è¼¯é¢æ¿ -->
    <div id="admin-panel" class="admin-panel">
        <div class="flex justify-between items-center mb-8 border-b pb-4">
            <h3 class="font-bold tracking-widest text-stone-800 uppercase">ç®¡ç†è€…æ¨¡å¼å·²é–‹å•Ÿ</h3>
            <button onclick="window.toggleAdmin()"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="space-y-10 pb-32">
            <section class="space-y-3">
                <h4 class="text-[10px] font-bold tracking-widest text-stone-400 uppercase">åŸºæœ¬é…ç½®</h4>
                <input type="text" id="edit-brand-name" placeholder="å“ç‰Œåç¨±">
                <textarea id="edit-hero-title" rows="2" placeholder="å¤§æ¨™é¡Œ"></textarea>
                <input type="text" id="edit-hero-sub" placeholder="å‰¯æ¨™é¡Œ">
                <label class="upload-btn">æ›´æ›é¦–é èƒŒæ™¯<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'hero')"></label>
            </section>
            
            <section class="space-y-3">
                <h4 class="text-[10px] font-bold tracking-widest text-stone-400 uppercase">æ•…äº‹èˆ‡ QR</h4>
                <textarea id="edit-about-text" rows="5" placeholder="æ•…äº‹å…§å®¹"></textarea>
                <div class="p-4 bg-stone-50 rounded-lg space-y-3">
                    <label class="upload-btn m-0">æ›´æ› QR åœ–ç‰‡<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'about_icon')"></label>
                    <input type="text" id="edit-about-link" placeholder="QR è·³è½‰é€£çµ">
                </div>
            </section>

            <!-- éˆçŸ³æ¸¬é©—åœ–ç‰‡ç®¡ç† -->
            <section class="space-y-3 bg-stone-50 p-4 rounded border border-stone-200">
                <h4 class="text-[10px] font-bold tracking-widest text-stone-500 uppercase flex items-center">
                    <i data-lucide="sparkles" class="w-3 h-3 mr-1"></i> éˆçŸ³æ¸¬é©—åœ–ç‰‡ç®¡ç†
                </h4>
                <div class="grid grid-cols-2 gap-2">
                    <label class="upload-btn text-[10px] m-0">æ·å…‹éš•çŸ³<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'calc_stone', 'moldavite')"></label>
                    <label class="upload-btn text-[10px] m-0">åˆ©æ¯”äºéš•çŸ³<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'calc_stone', 'libyan')"></label>
                    <label class="upload-btn text-[10px] m-0">é»‘éš•çŸ³<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'calc_stone', 'tektite')"></label>
                    <label class="upload-btn text-[10px] m-0">å¤©éµ<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'calc_stone', 'gibeon')"></label>
                    <label class="upload-btn text-[10px] m-0">æ©„æ¬–éš•çŸ³<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'calc_stone', 'pallasite')"></label>
                    <label class="upload-btn text-[10px] m-0">æ«»èŠ±ç‘ªç‘™<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'calc_stone', 'cherryAgate')"></label>
                </div>
                <p class="text-[9px] text-stone-400 mt-1">* ä¸Šå‚³å¾Œè«‹é»æ“Šä¸‹æ–¹ã€Œç™¼ä½ˆæ›´æ–°ã€ä»¥åŒæ­¥ã€‚</p>
            </section>

            <section class="space-y-3">
                <h4 class="text-[10px] font-bold tracking-widest text-stone-400 uppercase">å½±åƒå±•ç¤º (IG)</h4>
                <div class="space-y-4">
                    <div class="p-3 border rounded">
                        <input type="text" id="edit-ig-embed-1" placeholder="IG é€£çµ 1">
                        <label class="upload-btn text-[9px] m-0">æˆ–å‚™ç”¨åœ– 1<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'ig1')"></label>
                    </div>
                    <div class="p-3 border rounded">
                        <input type="text" id="edit-ig-embed-2" placeholder="IG é€£çµ 2">
                        <label class="upload-btn text-[9px] m-0">æˆ–å‚™ç”¨åœ– 2<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'ig2')"></label>
                    </div>
                    <div class="p-3 border rounded">
                        <input type="text" id="edit-ig-embed-3" placeholder="IG é€£çµ 3">
                        <label class="upload-btn text-[9px] m-0">æˆ–å‚™ç”¨åœ– 3<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'ig3')"></label>
                    </div>
                    <div class="p-3 border rounded">
                        <input type="text" id="edit-ig-embed-4" placeholder="IG é€£çµ 4">
                        <label class="upload-btn text-[9px] m-0">æˆ–å‚™ç”¨åœ– 4<input type="file" accept="image/*" class="hidden" onchange="window.handleImageUpload(this, 'ig4')"></label>
                    </div>
                </div>
            </section>

            <section class="space-y-3">
                <h4 class="text-[10px] font-bold tracking-widest text-stone-400 uppercase">ç¤¾ç¾¤é€£çµ</h4>
                <input type="text" id="edit-ig-handle" placeholder="IG åç¨±">
                <input type="text" id="edit-ig-url" placeholder="IG ç¶²å€">
                <input type="text" id="edit-fb-handle" placeholder="FB åç¨±">
                <input type="text" id="edit-fb-url" placeholder="FB ç¶²å€">
            </section>

            <div id="edit-collections-list" class="space-y-4"></div>
            <button onclick="window.addNewCollectionItem()" class="w-full py-3 bg-stone-100 text-xs">ï¼‹ æ–°å¢éˆçŸ³é …ç›®</button>
        </div>
        <div class="fixed bottom-0 right-0 w-full max-w-[450px] bg-white p-6 border-t z-[2000] shadow-2xl">
            <div class="grid grid-cols-2 gap-4">
                <button onclick="window.saveSiteData()" class="bg-stone-900 text-white py-4 text-xs font-bold uppercase rounded-sm shadow-lg">ç™¼ä½ˆæ›´æ–°</button>
                <button onclick="window.signOutAdmin()" class="bg-stone-50 text-stone-400 py-4 text-xs font-bold border border-stone-200 rounded-sm">ç™»å‡º</button>
            </div>
        </div>
    </div>

    <!-- é è…³ -->
    <footer class="py-24 px-8 bg-white border-t border-stone-200 text-center">
        <span class="text-xl font-bold tracking-[0.5em] text-stone-900 uppercase">å¥§å…’çµ²æœµ</span>
        <p class="text-[10px] tracking-[0.2em] text-stone-400 mt-8 font-medium">Â© 2025 OUR STORY. CURATED FOR YOUR SOUL.</p>
        <button onclick="window.toggleAdmin()" id="admin-action-btn" class="text-[9px] tracking-[0.2em] text-stone-300 mt-8 uppercase border-b border-transparent hover:border-stone-400 transition-colors">Admin Login</button>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, deleteDoc, collection, onSnapshot, query, initializeFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // === 1. å®šç¾©å…¨åŸŸè®Šæ•¸èˆ‡åŸºæœ¬åŠŸèƒ½ ===
        const ADMIN_UID = "0MFL33qKcbQIeln2X1wsHOl4ebo2".trim();
        const firebaseConfig = {
            apiKey: "AIzaSyDruZNMUyiJNcyoksYIBDHv5F1SiiG2Mss",
            authDomain: "our-story-53723.firebaseapp.com",
            projectId: "our-story-53723",
            storageBucket: "our-story-53723.firebasestorage.app",
            messagingSenderId: "651350028652",
            appId: "1:651350028652:web:44db9f6bd7d1b502578349"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = initializeFirestore(app, { experimentalForceLongPolling: true });
        let authInstance = auth; // è³¦å€¼çµ¦å…¨åŸŸä¾›æŒ‰éˆ•ä½¿ç”¨

        // å…¨åŸŸè®Šæ•¸
        let siteConfig = {};
        let calculatorConfig = {};
        let collectionsList = [];
        let currentLang = 'zh';

        // è¼‰å…¥ä¿è­·
        setTimeout(() => {
            const loading = document.getElementById('loading');
            if (loading && loading.style.display !== 'none') loading.style.display = 'none';
        }, 3000);

        // åŸºæœ¬ UI å‡½å¼
        window.scrollToSection = (id) => {
            const e = document.getElementById(id);
            if (e) { 
                window.scrollTo({ top: e.offsetTop - 80, behavior: 'smooth' }); 
                document.getElementById('mobile-menu').classList.remove('active'); 
            }
        };
        
        window.toggleMenu = () => {
            const m = document.getElementById('mobile-menu');
            m.classList.toggle('active');
        };

        window.generateDailyQuote = () => {
            const quotesPool = ["æ¯ä¸€é¡†éˆçŸ³ï¼Œéƒ½åœ¨è¨´èªªå®‡å®™çš„ç§˜å¯†ã€‚", "éœè¬ä¹‹ä¸­ï¼Œæ„Ÿå—å¤§åœ°çš„å‘¼å¸ã€‚", "å…‰å½±æŠ˜å°„ï¼Œæ˜ ç…§å‡ºéˆé­‚çš„ç´”ç²¹ã€‚", "ç©¿è¶Šå„„è¬å¹´çš„æ˜Ÿå¡µï¼Œåªç‚ºèˆ‡ä½ ç›¸é‡ã€‚", "å¿ƒå¦‚æ˜é¡ï¼Œå¡µåŸƒè‡ªè½ã€‚", "åœ¨çŸ³é ­çš„æº«æ½¤ä¸­ï¼Œæ‰¾å›å…§å¿ƒçš„å¹³éœã€‚", "ç¤¦çŸ³çš„ä½èªï¼Œæ˜¯æ™‚é–“ç•™ä¸‹çš„æƒ…æ›¸ã€‚", "æ“æŠ±è‡ªç„¶ï¼Œèˆ‡è¬ç‰©å…±é³´ã€‚", "ç´”ç²¹çš„å…‰ï¼Œç…§äº®æœªæ›¾å¯Ÿè¦ºçš„è§’è½ã€‚", "éœè½çŸ³èªï¼Œæ‰¾å°‹å¤±è½çš„è¨˜æ†¶ã€‚", "å¤§åœ°ä¹‹æ¯çš„é¥‹è´ˆï¼Œå€¼å¾—æº«æŸ”ä»¥å¾…ã€‚", "éˆé­‚çš„é »ç‡ï¼Œåœ¨è‰²å½©ä¸­é–ƒè€€ã€‚", "éœé»˜ï¼Œæ˜¯æœ€é«˜ç´šçš„æºé€šæ–¹å¼ã€‚", "ä¸åˆ»æ„æ¸²æŸ“ï¼Œç¾è‡ªæœƒæµ®ç¾ã€‚", "æ¯ä¸€é“è£‚ç—•ï¼Œéƒ½æ˜¯æˆé•·çš„å°è¨˜ã€‚", "èˆ‡çŸ³çµç·£ï¼Œå³æ˜¯èˆ‡è‡ªå·±é‡é€¢ã€‚", "æ˜Ÿè¾°éš•è½ï¼ŒåŒ–ä½œæŒå¿ƒçš„æº«åº¦ã€‚", "åœ¨å¿™ç¢Œçš„ä¸–ç•Œä¸­ï¼Œä¿æœ‰ä¸€æ–¹æ·¨åœŸã€‚", "å¿ƒä¹‹æ‰€å‘ï¼Œä¾¿æ˜¯èƒ½é‡æ‰€åœ¨ã€‚", "éˆçŸ³ç„¡è¨€ï¼Œå»æœ€æ‡‚ä½ çš„å¿ƒã€‚"];
            const sessionQuote = quotesPool[Math.floor(Math.random() * quotesPool.length)];
            const btn = document.getElementById('btn-daily-quote');
            const display = document.getElementById('ai-quote');
            btn.disabled = true; btn.innerText = "æ„Ÿæ‡‰ä¸­...";
            setTimeout(() => { display.innerText = `ã€Œ${sessionQuote}ã€`; btn.disabled = false; btn.innerText = "ç²å–ä»Šæ—¥çŸ³èª âœ¨"; }, 1200);
        };

        // --- éˆçŸ³æ¸¬é©—è³‡æ–™èˆ‡é‚è¼¯ ---
        const MONTH_EN = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        const I18N = {
            zh: { title: "å°‹æ‰¾æ‚¨çš„å‘½å®šéˆçŸ³", desc: `è¼¸å…¥æ‚¨çš„<span class="font-bold text-stone-700">åœ‹æ›† (Solar)</span> å‡ºç”Ÿæ—¥æœŸï¼Œ<br>ç³»çµ±å°‡è‡ªå‹•æ›ç®—ç²¾ç¢ºçš„è¾²æ›†äº”è¡Œï¼Œ<br>ç‚ºæ‚¨é€£çµé‚£é¡†ç­‰å¾…å·²ä¹…çš„å®ˆè­·çŸ³ã€‚`, labelYear: "åœ‹æ›†å‡ºç”Ÿå¹´", labelMonth: "åœ‹æ›†æœˆä»½", labelDay: "åœ‹æ›†æ—¥æœŸ", btnCalc: "é–‹å§‹è½‰æ›ä¸¦æ„Ÿæ‡‰", loading: "æ­£åœ¨æ›ç®—è¾²æ›†äº”è¡Œ...", resultTitle: "è¾²æ›†å‡ºç”Ÿè³‡è¨Š", btnCollection: "æŸ¥çœ‹æ”¶è—ç³»åˆ—", btnBuy: "æ´½è©¢å°ˆå“¡è³¼è²·", btnRetry: "é‡æ–°æ¸¬é©—", modalTitle: "å°ˆå“¡è³¼è—å”åŠ©", modalDesc: `è«‹ç•™ä¸‹æ‚¨çš„è³‡è¨Šï¼Œå°ˆå“¡å°‡ç‚ºæ‚¨ä»‹ç´¹ç¾è²¨æ¬¾å¼èˆ‡è³¼è²·æµç¨‹ã€‚<br><span class="text-stone-400 font-light block mt-1">(æ­¤æœå‹™å°ˆæ³¨æ–¼å”åŠ©è³¼è²·æŒ‘é¸ï¼Œéå‘½ç†è«®è©¢)</span>`, labelCName: "æ‚¨çš„ç¨±å‘¼", labelCContact: "è¯çµ¡æ–¹å¼ (æ‰‹æ©Ÿ / LINE ID)", btnSubmit: "ç¢ºèªé€å‡º", alertSent: "è³‡æ–™å·²é€å‡ºï¼ç¨å¾Œå°‡æœ‰å°ˆå“¡èˆ‡æ‚¨è¯ç¹«ã€‚", sending: "è³‡æ–™å‚³é€ä¸­...", selectYear: "è«‹é¸æ“‡å¹´ä»½", selectMonth: "æœˆä»½", selectDay: "æ—¥æœŸ", refImg: "ç¤ºæ„åœ–" },
            en: { title: "Find Your Destined Stone", desc: `Enter your <span class="font-bold text-stone-700">Solar Birth Date</span>.<br>We will calculate your Lunar Elemental Energy<br>to reveal your Guardian Stone.`, labelYear: "Birth Year (Solar)", labelMonth: "Birth Month", labelDay: "Birth Day", btnCalc: "Reveal My Stone", loading: "Calculating Cosmic Energy...", resultTitle: "Your Lunar Profile", btnCollection: "View Collection", btnBuy: "Contact for Purchase", btnRetry: "Retake Quiz", modalTitle: "Purchasing Assistance", modalDesc: `Leave your info, and a specialist will guide you through our collection.<br><span class="text-stone-400 font-light block mt-1">(Assistance for purchase, not fortune telling)</span>`, labelCName: "Your Name", labelCContact: "Contact (Phone / LINE / WhatsApp)", btnSubmit: "Submit", alertSent: "Sent! A specialist will contact you shortly.", sending: "Sending...", selectYear: "Select Year", selectMonth: "Month", selectDay: "Day", refImg: "Reference" }
        };

        const STONES = {
            moldavite: { name: { zh: "æ·å…‹éš•çŸ³", en: "Moldavite" }, desc: { zh: "ä¾†è‡ªå¤–å¤ªç©ºçš„ç¶ è‰²å¥‡è¹Ÿã€‚æ“æœ‰æ¥µé«˜çš„æŒ¯å‹•é »ç‡ï¼Œèƒ½æ‰“é€šå¿ƒè¼ªï¼ŒåŠ é€Ÿé¡˜æœ›é¡¯åŒ–ï¼Œå¸¶é ˜æ‚¨çªç ´ç¾ç‹€ï¼Œè¿æ¥éˆé­‚çš„è›»è®Šã€‚", en: "The green miracle from outer space. Opens the Heart Chakra and accelerates manifestation." }, tags: { zh: ["#è½‰åŒ–", "#å¿ƒè¼ª", "#æ‹›è²¡"], en: ["#Transformation", "#HeartChakra", "#Abundance"] }, img: "https://images.unsplash.com/photo-1617791160588-241658c0f566?auto=format&fit=crop&q=80&w=600", color: "text-green-700" },
            libyan: { name: { zh: "åˆ©æ¯”äºéš•çŸ³", en: "Libyan Desert Glass" }, desc: { zh: "æ²™æ¼ ä¸­çš„é»ƒé‡‘ä¹‹å…‰ã€‚æ“æœ‰å¼·å¤§çš„å¤ªé™½èƒ½é‡ï¼Œèƒ½å¢å¼·æ„å¿—åŠ›èˆ‡è‡ªä¿¡ï¼Œåƒæ²™æ¼ ä¸­çš„çƒˆæ—¥ä¸€æ¨£é©…æ•£é™°éœ¾ï¼Œå¸¶ä¾†è±ç››èˆ‡å®ˆè­·ã€‚", en: "Golden light of the desert. Strengthens will and confidence, bringing protection." }, tags: { zh: ["#æ„å¿—åŠ›", "#å¤ªé™½è¼ª", "#é¡¯åŒ–"], en: ["#Willpower", "#SolarPlexus", "#Manifestation"] }, img: "https://images.unsplash.com/photo-1610421272714-b15392e2764f?auto=format&fit=crop&q=80&w=600", color: "text-yellow-700" },
            tektite: { name: { zh: "é»‘éš•çŸ³", en: "Black Tektite" }, desc: { zh: "æœ€å¼·å¤§çš„é˜²ç¦¦ä¹‹ç›¾ã€‚å…·æœ‰æ·±åšçš„æ¥åœ°èƒ½é‡ï¼Œèƒ½æ’é™¤è² èƒ½é‡ã€æ¿æ°£ï¼Œç‚ºæ‚¨å»ºç«‹å¼·å¤§çš„èƒ½é‡å ´ï¼Œè®“èº«å¿ƒå›æ­¸ç©©å®šçš„å¹³éœã€‚", en: "The ultimate shield. Deep grounding energy that repels negativity." }, tags: { zh: ["#é¿é‚ª", "#æµ·åº•è¼ª", "#æ¥åœ°"], en: ["#Protection", "#RootChakra", "#Grounding"] }, img: "https://images.unsplash.com/photo-1596500954004-9a3d46cb0531?auto=format&fit=crop&q=80&w=600", color: "text-stone-800" },
            gibeon: { name: { zh: "å¤©éµ", en: "Gibeon Meteorite" }, desc: { zh: "å®‡å®™åŠ›é‡çš„å…·è±¡åŒ–ã€‚å…¶ç¨ç‰¹çš„ç¶­å¾·æ›¼äº¤è§’ç´‹è·¯æ˜¯å¼·å¤§èƒ½é‡çš„è­‰æ˜ï¼Œèƒ½æ‰“é€šä¸ƒè„ˆè¼ªï¼Œæå‡æ•´é«”æ°£å ´ï¼Œè³¦äºˆæ‚¨æœæ–·çš„è¡Œå‹•åŠ›ã€‚", en: "Cosmic power embodied. Unique patterns aligning all chakras and boosting aura." }, tags: { zh: ["#èƒ½é‡", "#æ°£å ´", "#è¡Œå‹•åŠ›"], en: ["#Energy", "#Aura", "#Action"] }, img: "https://images.unsplash.com/photo-1629804268393-3d0271701388?auto=format&fit=crop&q=80&w=600", color: "text-slate-500" },
            pallasite: { name: { zh: "æ©„æ¬–éš•çŸ³", en: "Pallasite" }, desc: { zh: "å¤©éµèˆ‡æ©„æ¬–çŸ³çš„å®Œç¾çµåˆã€‚è±¡å¾µå®‡å®™çš„å¹¸é‹èˆ‡å¯Œè¶³ï¼Œé‡‘é»ƒè‰²çš„å…‰èŠ’èƒ½å¸¶ä¾†æ„æƒ³ä¸åˆ°çš„å¥½é‹ï¼Œæ˜¯å°Šè²´èˆ‡è²¡å¯Œçš„è±¡å¾µã€‚", en: "Fusion of iron and olivine. Symbolizing cosmic luck, abundance and nobility." }, tags: { zh: ["#å¹¸é‹", "#è²¡å¯Œ", "#è²´äºº"], en: ["#Luck", "#Wealth", "#Nobility"] }, img: "https://images.unsplash.com/photo-1602117565819-d91d1e449208?auto=format&fit=crop&q=80&w=600", color: "text-yellow-700" },
            cherryAgate: { name: { zh: "æ«»èŠ±ç‘ªç‘™", en: "Cherry Blossom Agate" }, desc: { zh: "æº«æŸ”ç¶»æ”¾çš„ç”Ÿå‘½ä¹‹èŠ±ã€‚æ¯ä¸€æœµæ«»èŠ±éƒ½æ˜¯æ™‚é–“çš„å‡çµï¼Œèƒ½æ»‹é¤Šå¿ƒéˆï¼Œæå‡äººç·£èˆ‡é­…åŠ›ï¼Œè®“æ‚¨åœ¨å¿™ç¢Œä¸­ä¹Ÿèƒ½ä¿æœ‰ä¸€ä»½å„ªé›…èˆ‡å¾å®¹ã€‚", en: "Flowers of life gently blooming. Nurtures the soul and enhances charm." }, tags: { zh: ["#äººç·£", "#æº«æŸ”", "#ç™‚ç™’"], en: ["#Relationships", "#Gentleness", "#Healing"] }, img: "https://images.unsplash.com/photo-1550684848-fac1c5b4e853?auto=format&fit=crop&q=80&w=600", color: "text-pink-400" }
        };

        window.toggleLanguage = () => {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            document.getElementById('langLabel').innerText = currentLang === 'zh' ? 'English' : 'ä¸­æ–‡';
            updateCalcUI();
            populateDropdowns(); 
        };

        window.calculateStone = (e) => {
            if(e) e.preventDefault();
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);
            const day = parseInt(document.getElementById('day').value);
            if(!year || !month || !day) return;

            const resultArea = document.getElementById('resultArea');
            resultArea.classList.remove('hidden');
            if(e) {
                resultArea.innerHTML = `<div class="flex justify-center items-center py-10"><i data-lucide="loader-2" class="animate-spin h-8 w-8 text-stone-400"></i></div>`;
                lucide.createIcons();
            }
            const delay = e ? 1000 : 0;

            setTimeout(() => {
                const solar = Solar.fromYmd(year, month, day);
                const lunar = solar.getLunar();
                const lunarYear = lunar.getYear();
                const lunarMonth = lunar.getMonth();
                
                let dateDisplay = "";
                if (currentLang === 'zh') {
                    const ganZhiYear = lunar.getYearInGanZhi(); 
                    const zodiac = toTraditionalChinese(lunar.getYearShengXiao()); 
                    const lunarMonthChi = toTraditionalChinese(lunar.getMonthInChinese()); 
                    const lunarDayChi = lunar.getDayInChinese(); 
                    dateDisplay = `${ganZhiYear}å¹´ (${zodiac}) ${lunarMonthChi}æœˆ ${lunarDayChi}`;
                } else {
                    const zodiacEn = getZodiacEn(lunar.getYearShengXiao());
                    dateDisplay = `Lunar Year ${lunarYear} (${zodiacEn}) - Month ${lunarMonth}, Day ${lunar.getDay()}`;
                }

                const stoneKey = getStoneByFate(lunarYear, lunarMonth);
                const stone = STONES[stoneKey];
                renderResult(stone, dateDisplay);
            }, delay);
        };

        // è¼”åŠ©å‡½å¼
        function toTraditionalChinese(str) { const map = { 'é¾™': 'é¾', 'é©¬': 'é¦¬', 'é¸¡': 'é›', 'çŒª': 'è±¬', 'è…Š': 'è‡˜' }; return str.split('').map(char => map[char] || char).join(''); }
        function getZodiacEn(chi) { const map = { 'é¼ ': 'Rat', 'ç‰›': 'Ox', 'è™': 'Tiger', 'å…”': 'Rabbit', 'é¾': 'Dragon', 'è›‡': 'Snake', 'é¦¬': 'Horse', 'ç¾Š': 'Goat', 'çŒ´': 'Monkey', 'é›': 'Rooster', 'ç‹—': 'Dog', 'è±¬': 'Pig' }; return map[chi] || chi; }
        
        function getStoneByFate(y, m) {
            const d = y % 10;
            if (d <= 1) return (m>=10||m<=12)?'gibeon':(m>=4&&m<=6)?'tektite':'gibeon';
            if (d <= 3) return (m>=1&&m<=3)?'gibeon':'moldavite';
            if (d <= 5) return (m>=7&&m<=9)?'tektite':'moldavite';
            if (d <= 7) return (m>=10||m<=12)?'cherryAgate':(m>=4&&m<=6)?'libyan':'cherryAgate';
            return (m>=1&&m<=3)?'libyan':'pallasite';
        }

        // æ¸²æŸ“çµæœ - ä¿®æ­£ç‚º object-contain ä»¥è‡ªå‹•é©æ‡‰å¤§å°
        function renderResult(stone, date) {
            const t = I18N[currentLang];
            const name = stone.name[currentLang];
            const desc = stone.desc[currentLang];
            const tags = stone.tags[currentLang];
            const subTitle = currentLang === 'zh' ? stone.name.en : "";

            const html = `
                <div class="stone-card bg-stone-50 rounded-xl overflow-hidden shadow-sm border border-stone-100 fade-in">
                    <div class="bg-stone-100 p-4 border-b border-stone-200 text-center">
                        <p class="text-[10px] text-stone-400 tracking-wider mb-1 uppercase">${t.resultTitle}</p>
                        <p class="text-sm font-bold text-stone-700 tracking-widest">${date}</p>
                    </div>
                    <!-- åœ–ç‰‡å®¹å™¨ï¼šä½¿ç”¨ bg-stone-50 èˆ‡ object-contain è®“åœ–ç‰‡ä¸è£åˆ‡ä¸¦ç½®ä¸­ -->
                    <div class="relative h-64 overflow-hidden bg-stone-50 group border-b border-stone-100">
                        <img src="${stone.img}" class="w-full h-full object-contain p-4" onerror="this.src='https://placehold.co/600x400?text=Stone'">
                        <div class="absolute top-2 right-2 bg-black/30 text-white text-[9px] px-2 py-1 rounded backdrop-blur-sm tracking-wider">${t.refImg}</div>
                    </div>
                    <div class="p-8">
                        ${subTitle ? `<p class="text-xs text-stone-400 uppercase tracking-widest mb-4 font-bold">${subTitle}</p>` : ''}
                        <p class="text-sm text-stone-600 leading-loose tracking-wide mb-6 text-justify">${desc}</p>
                        <div class="flex justify-center space-x-2 mb-8 flex-wrap gap-y-2">
                            ${tags.map(tag => `<span class="px-3 py-1 bg-white border border-stone-200 rounded-full text-[10px] text-stone-500 tracking-wider">${tag}</span>`).join('')}
                        </div>
                        <div class="space-y-3">
                            <button onclick="window.scrollToSection('collections')" class="block w-full py-3 bg-stone-800 text-white text-xs font-bold tracking-[0.2em] uppercase rounded hover:bg-stone-600 transition text-center">${t.btnCollection}</button>
                            <button onclick="window.openContactModal()" class="block w-full py-3 bg-white border border-stone-200 text-stone-600 text-xs font-bold tracking-[0.2em] uppercase rounded hover:bg-stone-50 hover:border-stone-400 transition text-center">${t.btnBuy}</button>
                        </div>
                        <button onclick="document.getElementById('calcForm').reset(); document.getElementById('resultArea').classList.add('hidden');" class="mt-6 text-[10px] text-stone-400 border-b border-transparent hover:border-stone-400 hover:text-stone-600 transition">${t.btnRetry}</button>
                    </div>
                </div>`;
            document.getElementById('resultArea').innerHTML = html;
        }

        window.openContactModal = () => document.getElementById('contactModal').classList.remove('hidden');
        window.closeContactModal = () => document.getElementById('contactModal').classList.add('hidden');
        window.handleContactSubmit = (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            // XSS é˜²è­·
            const name = escapeHtml(document.getElementById('cName').value);
            const contact = escapeHtml(document.getElementById('cContact').value);

            btn.disabled = true; btn.innerText = I18N[currentLang].sending;
            setTimeout(() => {
                alert(I18N[currentLang].alertSent);
                btn.disabled = false; btn.innerText = originalText;
                e.target.reset(); window.closeContactModal();
            }, 1000);
        };
        
        function updateCalcUI() {
            const t = I18N[currentLang];
            const safeSetText = (id, val) => { const el = document.getElementById(id); if (el) el.innerText = val; };
            const safeSetHTML = (id, val) => { const el = document.getElementById(id); if (el) el.innerHTML = val; };
            safeSetText('ui-title', t.title); safeSetHTML('ui-desc', t.desc);
            safeSetText('label-year', t.labelYear); safeSetText('label-month', t.labelMonth); safeSetText('label-day', t.labelDay);
            safeSetText('btn-calc', t.btnCalc);
            const loadingEl = document.getElementById('loading-text'); if(loadingEl) loadingEl.innerText = t.loading;
            safeSetText('modal-title', t.modalTitle); safeSetHTML('modal-desc', t.modalDesc);
            safeSetText('label-cName', t.labelCName); safeSetText('label-cContact', t.labelCContact);
            safeSetText('btn-submit', t.btnSubmit);
            const resultArea = document.getElementById('resultArea');
            if (resultArea && !resultArea.classList.contains('hidden')) { if(document.getElementById('year').value) window.calculateStone(); }
        }

        function populateDropdowns() {
            const yearSelect = document.getElementById('year');
            const monthSelect = document.getElementById('month');
            const daySelect = document.getElementById('day');
            const valY = yearSelect.value; const valM = monthSelect.value; const valD = daySelect.value;
            
            yearSelect.innerHTML = `<option value="" disabled selected>${I18N[currentLang].selectYear}</option>`;
            monthSelect.innerHTML = `<option value="" disabled selected>${I18N[currentLang].selectMonth}</option>`;
            daySelect.innerHTML = `<option value="" disabled selected>${I18N[currentLang].selectDay}</option>`;

            for (let i = 2025; i >= 1950; i--) { let o = document.createElement('option'); o.value = i; o.text = currentLang === 'zh' ? `è¥¿å…ƒ ${i} å¹´` : `${i}`; yearSelect.appendChild(o); }
            for (let i = 1; i <= 12; i++) { let o = document.createElement('option'); o.value = i; o.text = currentLang === 'zh' ? `${i}æœˆ` : MONTH_EN[i-1]; monthSelect.appendChild(o); }
            for (let i = 1; i <= 31; i++) { let o = document.createElement('option'); o.value = i; o.text = currentLang === 'zh' ? `${i}æ—¥` : `${i}`; daySelect.appendChild(o); }
            if(valY) yearSelect.value = valY; if(valM) monthSelect.value = valM; if(valD) daySelect.value = valD;
        }

        // === å…§éƒ¨é‚è¼¯å‡½å¼ ===
        function initNavbarScroll() {
            const nav = document.getElementById('navbar');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    nav.classList.add('nav-scrolled');
                } else {
                    nav.classList.remove('nav-scrolled');
                }
            });
        }

        // å„ªåŒ–å¾Œçš„åœ–ç‰‡ä¸Šå‚³èˆ‡å£“ç¸®é‚è¼¯ (åŒæ™‚é™åˆ¶å¯¬èˆ‡é«˜)
        window.handleImageUpload = (input, target, extra = null) => {
            const file = input.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    // é›™é‡é™åˆ¶ï¼šå¯¬åº¦æˆ–é«˜åº¦éƒ½ä¸èƒ½è¶…é 800px
                    let width = img.width;
                    let height = img.height;
                    const maxDim = 800;

                    if (width > height) {
                        if (width > maxDim) {
                            height *= maxDim / width;
                            width = maxDim;
                        }
                    } else {
                        if (height > maxDim) {
                            width *= maxDim / height;
                            height = maxDim;
                        }
                    }

                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    let base64 = canvas.toDataURL('image/jpeg', 0.8);
                    
                    if (target === 'hero') siteConfig.heroImg = base64;
                    else if (target === 'about_icon') siteConfig.aboutIcon = base64;
                    else if (target.startsWith('ig')) siteConfig[`igImg${target.slice(2)}`] = base64;
                    else if (target === 'col') collectionsList[extra].img = base64;
                    else if (target === 'calc_stone') {
                        if (!calculatorConfig.stones) calculatorConfig.stones = {};
                        calculatorConfig.stones[extra] = base64;
                    }
                    alert("ç…§ç‰‡æº–å‚™å°±ç·’ï¼Œè«‹è¨˜å¾—æŒ‰ç™¼ä½ˆæ›´æ–°ã€‚");
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        };

        window.addNewCollectionItem = () => {
            collectionsList.unshift({ id: 'temp_' + Date.now(), name: "æ–°æ”¶è—", desc: "èƒ½é‡æè¿°", img: "", createdAt: Date.now(), isNew: true });
            window.renderAdminList();
        };
        window.updateLocalItem = (index, field, value) => { collectionsList[index][field] = value; };
        window.deleteItem = async (id) => {
            if (!confirm("ç¢ºå®šç§»é™¤å—ï¼Ÿ")) return;
            if (id.startsWith('temp_')) { collectionsList = collectionsList.filter(i => i.id !== id); window.renderAdminList(); }
            else { await deleteDoc(doc(db, 'artifacts', 'our-story-53723', 'public', 'data', 'galleryItems', id)); }
        };

        window.saveSiteData = async () => {
            if (!authInstance.currentUser || authInstance.currentUser.uid.trim() !== ADMIN_UID) return alert("æ¬Šé™ä¸è¶³ï¼");
            document.getElementById('loading').style.display = 'flex';
            try {
                const configRef = doc(db, 'artifacts', 'our-story-53723', 'public', 'data', 'siteSettings', 'main');
                const updateData = { 
                    ...siteConfig, 
                    brandName: document.getElementById('edit-brand-name')?.value || siteConfig.brandName, 
                    heroTitle: document.getElementById('edit-hero-title')?.value || siteConfig.heroTitle, 
                    heroSub: document.getElementById('edit-hero-sub')?.value || siteConfig.heroSub, 
                    aboutText: document.getElementById('edit-about-text')?.value || siteConfig.aboutText, 
                    aboutLink: document.getElementById('edit-about-link')?.value || siteConfig.aboutLink,
                    igHandle: document.getElementById('edit-ig-handle')?.value || siteConfig.igHandle,
                    igUrl: document.getElementById('edit-ig-url')?.value || siteConfig.igUrl,
                    fbHandle: document.getElementById('edit-fb-handle')?.value || siteConfig.fbHandle,
                    fbUrl: document.getElementById('edit-fb-url')?.value || siteConfig.fbUrl
                };
                for(let i=1; i<=4; i++) { 
                    const val = document.getElementById(`edit-ig-embed-${i}`)?.value;
                    if(val !== undefined) updateData[`igEmbed${i}`] = val; 
                }
                await setDoc(configRef, updateData);

                if (calculatorConfig && Object.keys(calculatorConfig).length > 0) {
                    const calcRef = doc(db, 'artifacts', 'our-story-53723', 'public', 'data', 'siteSettings', 'calculator');
                    await setDoc(calcRef, calculatorConfig);
                }

                for (const item of collectionsList) {
                    const id = item.isNew ? doc(collection(db, 'dummy')).id : item.id;
                    const itemRef = doc(db, 'artifacts', 'our-story-53723', 'public', 'data', 'galleryItems', id);
                    const cleanItem = { ...item }; delete cleanItem.id; delete cleanItem.isNew;
                    await setDoc(itemRef, cleanItem);
                }
                alert("åŒæ­¥æˆåŠŸï¼");
            } catch (e) { alert("å¤±æ•—: " + e.message); }
            finally { document.getElementById('loading').style.display = 'none'; }
        };

        // --- ç®¡ç†å“¡ç™»å…¥é‚è¼¯ (æ¢å¾©ä½¿ç”¨ prompt) ---
        window.toggleAdmin = async () => {
            const panel = document.getElementById('admin-panel');
            const currentUid = authInstance.currentUser?.uid?.trim();
            
            if (authInstance.currentUser && currentUid === ADMIN_UID) {
                panel.classList.toggle('active');
            } else {
                const email = prompt("Email:"); if (!email) return;
                const pass = prompt("Password:"); if (!pass) return;
                try {
                    const cred = await signInWithEmailAndPassword(authInstance, email, pass);
                    if (cred.user.uid.trim() === ADMIN_UID) {
                        alert("èº«åˆ†æ ¸å°æˆåŠŸï¼");
                        panel.classList.add('active');
                        document.getElementById('admin-action-btn').innerText = "ç®¡ç†æ¨¡å¼ (å·²ç™»å…¥)";
                        window.renderAdminList();
                    } else {
                        alert("ä¸å…·å‚™ç®¡ç†æ¬Šé™ã€‚"); await signOut(authInstance);
                    }
                } catch(e) { alert("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ã€‚"); }
            }
        };

        window.signOutAdmin = () => { 
            if(!confirm("ç¢ºå®šè¦ç™»å‡ºç®¡ç†å“¡èº«ä»½å—ï¼Ÿ")) return;
            signOut(authInstance).then(() => { alert("å·²å®‰å…¨ç™»å‡ºã€‚"); window.location.reload(); }); 
        };
        
        // æ¸²æŸ“å‡½å¼ç¾¤
        function renderIgSlot(slotId, embedUrl, fallbackImg) {
            const container = document.getElementById(slotId);
            if (!container) return;
            if (embedUrl && embedUrl.trim() !== "") {
                container.innerHTML = `<blockquote class="instagram-media" data-instgrm-permalink="${embedUrl}" data-instgrm-version="14" style="background:#FFF; border:0; margin:0; width:100%;"><div style="padding:16px;"> <a href="${embedUrl}" target="_blank" style="background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;">View on Instagram</a></div></blockquote>`;
            } else if (fallbackImg) {
                container.innerHTML = `<img src="${fallbackImg}" class="w-full h-full object-cover opacity-95 hover:scale-105" alt="Showcase">`;
            } else {
                container.innerHTML = `<div class="w-full h-full bg-stone-100 flex items-center justify-center text-stone-300 text-[10px]">å½±åƒè¼‰å…¥ä¸­</div>`;
            }
        }

        function renderFrontEnd() {
            // (ç°¡åŒ–ç‰ˆï¼Œç¢ºä¿ ID å­˜åœ¨æ‰æ›´æ–°)
            const safeSetText = (id, text) => { if(document.getElementById(id)) document.getElementById(id).innerText = text || ""; };
            const safeSetSrc = (id, src) => { if(document.getElementById(id)) document.getElementById(id).src = src || ""; };
            const safeSetHref = (id, href) => { if(document.getElementById(id)) document.getElementById(id).href = href || "#"; };
            const safeSetVal = (id, val) => { if(document.getElementById(id)) document.getElementById(id).value = val || ""; };

            safeSetText('nav-brand-display', siteConfig.brandName);
            safeSetText('hero-title-display', siteConfig.heroTitle);
            safeSetText('hero-sub-display', siteConfig.heroSub);
            if (siteConfig.heroImg) safeSetSrc('hero-img-display', siteConfig.heroImg);
            safeSetText('about-text-display', siteConfig.aboutText);
            if (siteConfig.aboutIcon) safeSetSrc('about-icon-display', siteConfig.aboutIcon);
            safeSetHref('about-link-display', siteConfig.aboutLink);
            
            safeSetText('ig-text-display', `Instagram / ${siteConfig.igHandle}`);
            safeSetText('fb-text-display', `Facebook / ${siteConfig.fbHandle}`);
            safeSetHref('ig-link-display', siteConfig.igUrl);
            safeSetHref('fb-link-display', siteConfig.fbUrl);

            for(let i=1; i<=4; i++) { renderIgSlot(`ig-slot-${i}`, siteConfig[`igEmbed${i}`], siteConfig[`igImg${i}`]); }
            setTimeout(() => { if (window.instgrm) window.instgrm.Embeds.process(); }, 1000);
            
            safeSetVal('edit-brand-name', siteConfig.brandName);
            safeSetVal('edit-hero-title', siteConfig.heroTitle);
            safeSetVal('edit-hero-sub', siteConfig.heroSub);
            safeSetVal('edit-about-text', siteConfig.aboutText);
            safeSetVal('edit-about-link', siteConfig.aboutLink);
            safeSetVal('edit-ig-handle', siteConfig.igHandle);
            safeSetVal('edit-ig-url', siteConfig.igUrl);
            safeSetVal('edit-fb-handle', siteConfig.fbHandle);
            safeSetVal('edit-fb-url', siteConfig.fbUrl);
            for(let i=1; i<=4; i++) { safeSetVal(`edit-ig-embed-${i}`, siteConfig[`igEmbed${i}`]); }
        }

        function renderCollections() {
            const container = document.getElementById('collections-container');
            if (!container) return;
            container.innerHTML = collectionsList.map(item => `
                <article class="group flex flex-col items-center">
                    <div class="aspect-[4/5] w-full overflow-hidden bg-stone-200 shadow-sm">
                        <img src="${item.img}" class="w-full h-full object-cover transition-all duration-[1500ms] group-hover:scale-110" alt="${item.name}">
                    </div>
                    <h3 class="text-base font-medium mt-6 tracking-widest text-stone-900 uppercase">${item.name}</h3>
                    <p class="text-xs text-stone-500 mt-2 tracking-widest">${item.desc}</p>
                </article>
            `).join('');
        }

        // å°‡å‡½å¼æ›è¼‰åˆ° window ä»¥ä¾›å…¨åŸŸå‘¼å«
        window.renderAdminList = function() {
            const list = document.getElementById('edit-collections-list');
            if (!list) return;
            list.innerHTML = collectionsList.map((item, index) => `<div class="p-4 bg-stone-50 rounded border border-stone-200 space-y-2 relative shadow-sm"><button onclick="deleteItem('${item.id}')" class="absolute top-2 right-2 text-red-300 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button><input type="text" value="${item.name}" onchange="updateLocalItem(${index}, 'name', this.value)" class="text-xs font-bold"><textarea onchange="updateLocalItem(${index}, 'desc', this.value)" class="text-xs">${item.desc}</textarea><label class="upload-btn m-0 py-2 px-3 text-[10px]">æ›ç…§<input type="file" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'col', ${index})"></label></div>`).join('');
            lucide.createIcons();
        }

        // å•Ÿå‹•é‚è¼¯
        document.getElementById('loading').style.display = 'flex';
        initNavbarScroll();
        populateDropdowns();
        
        onAuthStateChanged(auth, (user) => {
            const panel = document.getElementById('admin-panel');
            const btn = document.getElementById('admin-action-btn');
            const currentUid = user?.uid?.trim();
            if (user && currentUid === ADMIN_UID) {
                panel.classList.add('active');
                btn.innerText = "ç®¡ç†æ¨¡å¼ (å·²ç™»å…¥)";
                window.renderAdminList();
            } else {
                panel.classList.remove('active');
                btn.innerText = "Admin Login";
            }
            
            // è¼‰å…¥è³‡æ–™
            onSnapshot(doc(db, 'artifacts', 'our-story-53723', 'public', 'data', 'siteSettings', 'main'), (snap) => {
                if (snap.exists()) { siteConfig = { ...siteConfig, ...snap.data() }; renderFrontEnd(); }
            });
            onSnapshot(doc(db, 'artifacts', 'our-story-53723', 'public', 'data', 'siteSettings', 'calculator'), (snap) => {
                if (snap.exists()) { 
                    calculatorConfig = snap.data(); 
                    if (calculatorConfig.stones) {
                        Object.keys(calculatorConfig.stones).forEach(key => {
                            if (STONES[key] && calculatorConfig.stones[key]) STONES[key].img = calculatorConfig.stones[key];
                        });
                    }
                }
                document.getElementById('loading').style.display = 'none';
            });
            onSnapshot(collection(db, 'artifacts', 'our-story-53723', 'public', 'data', 'galleryItems'), (snap) => {
                collectionsList = []; snap.forEach(d => collectionsList.push({ id: d.id, ...d.data() }));
                collectionsList.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                renderCollections();
                if (document.getElementById('admin-panel').classList.contains('active')) window.renderAdminList();
            });
        });
        
        await signInAnonymously(auth).catch(() => {});
        lucide.createIcons();
    </script>
</body>
</html>
